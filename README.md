# SphereAgent - Android Remote Control Agent

Enterprise-grade Android agent –¥–ª—è —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏

![Android](https://img.shields.io/badge/Android-26+-green)
![Kotlin](https://img.shields.io/badge/Kotlin-2.0-purple)
![Compose](https://img.shields.io/badge/Jetpack_Compose-2024.04-blue)
![Version](https://img.shields.io/badge/Version-1.5.2-orange)

## üÜï –ß—Ç–æ –Ω–æ–≤–æ–≥–æ –≤ v1.5.1 (Local Logs & Connection Fix) üöÄ

**The "Listen to User" Update** - –î–æ–±–∞–≤–ª–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.

### üìù –õ–æ–∫–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
- **–ö–Ω–æ–ø–∫–∞ "Show Logs"**: –¢–µ–ø–µ—Ä—å –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ª–æ–≥–æ–≤.
- **–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ**: –õ–æ–≥–∏ –º–æ–∂–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞ –æ–¥–Ω–æ–π –∫–Ω–æ–ø–∫–æ–π, –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞.
- **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**: –¢–µ–ø–µ—Ä—å —Ç—ã –º–æ–∂–µ—à—å —Å–∞–º —É–≤–∏–¥–µ—Ç—å, –ø–æ—á–µ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è, –∏ —Å–∫–∏–Ω—É—Ç—å –ª–æ–≥–∏ –º–Ω–µ.

### üåê –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (v2)
- **Fix Double WS**: –£—Å—Ç—Ä–∞–Ω–µ–Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞, –∏–∑-–∑–∞ –∫–æ—Ç–æ—Ä–æ–π –∫ URL –¥–æ–±–∞–≤–ª—è–ª–æ—Å—å –ª–∏—à–Ω–µ–µ `/ws/`, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ 404 –æ—à–∏–±–∫–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.
- **Smart URL**: –¢–µ–ø–µ—Ä—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ª—é–±—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –∞–¥—Ä–µ—Å–∞ —Å–µ—Ä–≤–µ—Ä–∞.

---

## üÜï –ß—Ç–æ –Ω–æ–≤–æ–≥–æ –≤ v1.5.0 (Stable Tunnel & Remote Logs) üöÄ

**Critical Fixes & Debugging** - –°–∞–º–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —á–µ—Ä–µ–∑ —Ç—É–Ω–Ω–µ–ª—å.

### üåê –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- **Fix URL doubling**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ `/ws/ws/`, –∫–æ—Ç–æ—Ä–∞—è –º–µ—à–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é.
- **Stable Tunnel**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã —á–µ—Ä–µ–∑ `sphereadb.ru.tuna.am`.
- **Fallback Update**: –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∞–¥—Ä–µ—Å–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤.

### üìù –£–¥–∞–ª—ë–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (SphereLog)
- **Remote Debugging**: –ê–≥–µ–Ω—Ç —Ç–µ–ø–µ—Ä—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–≤–æ–∏ –ª–æ–≥–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä.
- **Batch Sending**: –õ–æ–≥–∏ –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —Ç—Ä–∞—Ñ–∏–∫–∞.
- **Error Tracking**: –¢–µ–ø–µ—Ä—å –º—ã –º–æ–∂–µ–º –≤–∏–¥–µ—Ç—å –æ—à–∏–±–∫–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø—Ä—è–º–æ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—ç–∫–µ–Ω–¥–∞.

### üì¶ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- **Code Cleanup**: –£–¥–∞–ª–µ–Ω—ã –¥—É–±–ª–∏–∫–∞—Ç—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ ViewModel.
- **Memory Fix**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —É—Ç–µ—á–∫–∏ –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏.

---

## üÜï –ß—Ç–æ –Ω–æ–≤–æ–≥–æ –≤ v1.3.1 (Ideal Reconnect) üöÄ

**Connectivity Optimization** - –ê–≥–µ–Ω—Ç —Ç–µ–ø–µ—Ä—å –í–°–ï–ì–î–ê –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è!

### üîÑ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Reconnect
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞**: –°–Ω–∏–∂–µ–Ω–∞ —Å 5 –º–∏–Ω—É—Ç –¥–æ 1 –º–∏–Ω—É—Ç—ã
- **–ü–ª–∞–≤–Ω—ã–π —Ä–æ—Å—Ç**: Backoff multiplier –∏–∑–º–µ–Ω—ë–Ω —Å 2.0 –Ω–∞ 1.5
- **–ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º**: –ê–≥–µ–Ω—Ç –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –≥–æ—Ä–∞–∑–¥–æ —á–∞—â–µ

### üåê –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ Fallback URLs
- **–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ç—É–Ω–Ω–µ–ª–∏**: `sphereadb-api-v2.ru.tuna.am`
- **Dead Drop**: –û–±–Ω–æ–≤–ª–µ–Ω—ã hardcoded URLs
- **Build Config**: –û–±–Ω–æ–≤–ª–µ–Ω—ã –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–±–æ—Ä–∫–∏

### üì¶ –†–∞–∑–º–µ—Ä APK
- **16 MB** (–±–µ–∑ minification –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Å–±–æ—Ä–∫–∏)

---

## üÜï –ß—Ç–æ –Ω–æ–≤–æ–≥–æ –≤ v1.1.0 (Critical Reliability) üî¥

**Stage 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å** - –ê–≥–µ–Ω—Ç —Ç–µ–ø–µ—Ä—å –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –Ω–∞–¥—ë–∂–Ω–µ–µ!

### ‚ù§Ô∏è Heartbeat —Å —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–µ–π
- CPU usage (%)
- RAM usage (%, –¥–æ—Å—Ç—É–ø–Ω–æ MB)
- Battery level –∏ —Å—Ç–∞—Ç—É—Å –∑–∞—Ä—è–¥–∫–∏
- Network type –∏ —Å–∏–ª–∞ —Å–∏–≥–Ω–∞–ª–∞
- Foreground app (–∞–∫—Ç–∏–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)
- Screen on/off
- Agent uptime
- Battery temperature

### üíÄ Reaper (–ñ–Ω–µ—Ü) –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- 3 –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö heartbeat ‚Üí —Å—Ç–∞—Ç—É—Å OFFLINE
- 5 –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö heartbeat ‚Üí disconnect
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤

### üîÑ AlarmManager Watchdog
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞ –ø—Ä–∏ kill —Å–∏—Å—Ç–µ–º–æ–π
- –†–∞–±–æ—Ç–∞–µ—Ç –≤ Doze mode

### üì¶ –õ–æ–∫–∞–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –∫–æ–º–∞–Ω–¥
- –ö–æ–º–∞–Ω–¥—ã –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Å–≤—è–∑–∏
- –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ –¥–∏—Å–∫
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏
- Retry –¥–ª—è failed –∫–æ–º–∞–Ω–¥ (–¥–æ 3 –ø–æ–ø—ã—Ç–æ–∫)

---

## üÜï –ß—Ç–æ –Ω–æ–≤–æ–≥–æ –≤ v1.0.6 (Enhanced Discovery)

- **üåê Dual Tunnel Support** - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–±–æ–∏—Ö —Ç—É–Ω–Ω–µ–ª–µ–π (`sphere-api` –∏ `sphere-web`) –≤ fallback —Å–ø–∏—Å–∫–µ
- **üõ°Ô∏è Discovery Logic** - –£–ª—É—á—à–µ–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –≤—ã–±–æ—Ä–∞ —Å–µ—Ä–≤–µ—Ä–∞
- **üêõ Bug Fixes** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö Docker IP –∞–¥—Ä–µ—Å–æ–≤

## üì± –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **üì∫ Real-time Screen Streaming** - –¢—Ä–∞–Ω—Å–ª—è—Ü–∏—è —ç–∫—Ä–∞–Ω–∞ —á–µ—Ä–µ–∑ WebSocket (JPEG binary frames)
- **üéÆ Remote Control** - Tap, Swipe, Key events, Shell commands
- **üîÑ Auto-Reconnect** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å exponential backoff
- **üåê Fallback Servers** - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤ –¥–ª—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏
- **‚öôÔ∏è Remote Config** - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å —Å–µ—Ä–≤–µ—Ä–∞
- **üîí Secure Connection** - WSS/HTTPS —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è |
|-----------|------------|
| Language | Kotlin 2.0.21 |
| UI | Jetpack Compose (Material 3) |
| DI | Hilt 2.52 |
| Network | OkHttp 4.12 + WebSocket |
| Persistence | DataStore 1.1.1 |
| Serialization | Kotlinx Serialization |
| Screen Capture | MediaProjection API |
| Input | Accessibility Service / Shell |

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
app/src/main/java/com/sphere/agent/
‚îú‚îÄ‚îÄ SphereAgentApp.kt          # Application class
‚îú‚îÄ‚îÄ MainActivity.kt            # Main Activity
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ AgentConfig.kt         # Remote config management
‚îÇ   ‚îî‚îÄ‚îÄ DeviceMetrics.kt       # üÜï –¢–µ–ª–µ–º–µ—Ç—Ä–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ SettingsRepository.kt  # DataStore repository
‚îÇ   ‚îî‚îÄ‚îÄ CommandQueue.kt        # üÜï –û—á–µ—Ä–µ–¥—å –∫–æ–º–∞–Ω–¥
‚îú‚îÄ‚îÄ di/
‚îÇ   ‚îî‚îÄ‚îÄ AppModule.kt           # Hilt modules
‚îú‚îÄ‚îÄ network/
‚îÇ   ‚îî‚îÄ‚îÄ ConnectionManager.kt   # WebSocket + Queue sync
‚îú‚îÄ‚îÄ receiver/
‚îÇ   ‚îú‚îÄ‚îÄ BootReceiver.kt        # Auto-start
‚îÇ   ‚îú‚îÄ‚îÄ NetworkReceiver.kt     # Network changes
‚îÇ   ‚îî‚îÄ‚îÄ WatchdogReceiver.kt    # üÜï AlarmManager watchdog
‚îú‚îÄ‚îÄ service/
‚îÇ   ‚îú‚îÄ‚îÄ ScreenCaptureService.kt    # Foreground service
‚îÇ   ‚îú‚îÄ‚îÄ CommandExecutor.kt         # Shell commands
‚îÇ   ‚îî‚îÄ‚îÄ SphereAccessibilityService.kt  # Non-root input
‚îî‚îÄ‚îÄ ui/
    ‚îú‚îÄ‚îÄ screens/
    ‚îÇ   ‚îî‚îÄ‚îÄ MainScreen.kt      # Main UI
    ‚îî‚îÄ‚îÄ viewmodel/
        ‚îî‚îÄ‚îÄ MainViewModel.kt   # State management
```

## üì• –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –°–∫–∞—á–∞–π—Ç–µ –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é APK
2. –†–∞–∑—Ä–µ—à–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É –∏–∑ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ APK
4. –î–∞–π—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è (Accessibility, Notification, Screen Capture)
5. –ê–≥–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

–ê–≥–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Ö–æ–¥–∏—Ç —Å–µ—Ä–≤–µ—Ä –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø–æ—Ä—è–¥–∫–µ:
1. Remote Config —Å GitHub
2. –ü—É–±–ª–∏—á–Ω—ã–π —Ç—É–Ω–Ω–µ–ª—å `sphereadb-api-v2.ru.tuna.am`
3. mDNS/NSD –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏
4. –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥—Å–µ—Ç–∏
5. Hardcoded fallback URLs

## üìã Changelog

| –í–µ—Ä—Å–∏—è | –î–∞—Ç–∞ | –ò–∑–º–µ–Ω–µ–Ω–∏—è |
|--------|------|-----------|
| 1.5.1 | 2025-12-23 | üöÄ Local Logs: –ö–Ω–æ–ø–∫–∞ Show Logs, Copy to Clipboard, Fix Double WS URL |
| 1.5.0 | 2025-12-23 | üöÄ Stable Tunnel: Fix /ws/ws/, SphereLog remote debugging, fallback update |
| 1.3.1 | 2025-12-07 | üöÄ Ideal Reconnect: 1min backoff, v2 tunnel URLs, aggressive retry |
| 1.1.0 | 2025-12-03 | üî¥ Stage 1: Heartbeat —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è, Reaper, Watchdog, CommandQueue |
| 1.0.6 | 2025-12-03 | Enhanced Discovery: dual tunnels |
| 1.0.5 | 2025-12-03 | Global Access: tunnel priority |
| 1.0.4 | 2025-12-02 | Zero-Config Auto-Discovery |
| 1.0.3 | 2025-12-02 | Release build (minified) |

## üìÑ License

MIT License - —Å–º. –æ—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π [SphereADB](https://github.com/RootOne1337/SphereADB)
